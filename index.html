<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Winions Meme Generator</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
const { useState, useEffect } = React;

const Download = ({ className }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
  </svg>
);

const Sparkles = ({ className }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
  </svg>
);

const Zap = ({ className }) => (
  <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
  </svg>
);

function WinionsMemeGenerator() {
  const [selectedTemplate, setSelectedTemplate] = useState('distracted');
  const [texts, setTexts] = useState({
    text1: 'MY GIRLFRIEND',
    text2: 'ME', 
    text3: 'OTHER WINIONS'
  });
  const [isGenerating, setIsGenerating] = useState(false);
  const [previewCanvas, setPreviewCanvas] = useState(null);
  const [generatedBackground, setGeneratedBackground] = useState(null);
  const [selectedWinions, setSelectedWinions] = useState([]);

  const winionsCollection = [
    '/winions/clay-min.gif',
    '/winions/frog-min.gif',
    '/winions/General hologram-min.gif',
    '/winions/gold general-min.gif',
    '/winions/gold-min.gif',
    '/winions/havoc-min.gif',
    '/winions/hellish-min.gif',
    '/winions/hologram-min.gif',
    '/winions/misfit-min.gif',
    '/winions/royal-min.gif',
    '/winions/shadow-min.gif',
    '/winions/spectrum-min.gif',
    '/winions/stencil-min.gif',
    '/winions/theory-min.gif',
    '/winions/unknow-min.gif'
  ];

  const templates = {
    distracted: {
      name: 'Distracted Boyfriend',
      description: '3 characters on street',
      fields: ['text1', 'text2', 'text3'],
      labels: ['Girlfriend', 'Boyfriend', 'Other Person'],
      winionsNeeded: 3,
      prompt: 'Empty street sidewalk scene with three distinct standing positions: left position (girlfriend walking away angry), center position (boyfriend looking back), right position (attractive person standing). Urban background, realistic lighting, NO people, NO characters, just empty positions marked by subtle ground shadows. Photorealistic style, cinematic composition, 16:9 aspect ratio',
      positions: [
        { x: 100, y: 200, size: 200, label: 'left' },
        { x: 400, y: 180, size: 220, label: 'center' },
        { x: 700, y: 200, size: 200, label: 'right' }
      ]
    },
    drake: {
      name: 'Drake Hotline Bling',
      description: '2 panel reject/approve',
      fields: ['text1', 'text2'],
      labels: ['Reject This', 'Approve This'],
      winionsNeeded: 1,
      prompt: 'Two panel meme template: Top panel has empty space on left for character with rejected/disapproving gesture, plain background. Bottom panel has empty space on left for same character but with approving/pointing gesture, same background. Split screen horizontal panels, minimal background, NO people, just empty character positions. Clean modern style',
      positions: [
        { x: 50, y: 100, size: 250, label: 'top' },
        { x: 50, y: 450, size: 250, label: 'bottom' }
      ]
    },
    buttons: {
      name: 'Two Buttons',
      description: 'Sweating over choices',
      fields: ['text1', 'text2'],
      labels: ['Button 1', 'Button 2'],
      winionsNeeded: 1,
      prompt: 'Meme template showing two large red buttons on a control panel or desk, positioned at top of image. Empty space below for character looking up at buttons with stressed expression. Office or control room setting, NO people, cinematic lighting, photorealistic',
      positions: [
        { x: 400, y: 450, size: 280, label: 'character' }
      ]
    },
    yelling: {
      name: 'Woman Yelling at Cat',
      description: 'Dinner table argument',
      fields: ['text1', 'text2'],
      labels: ['Yelling Side', 'Cat Side'],
      winionsNeeded: 2,
      prompt: 'Split panel meme template: Left side shows empty chair at dinner table (for arguing character), right side shows empty chair with plate and food at dinner table (for confused character). Restaurant or dining room background, NO people, realistic lighting, two distinct positions',
      positions: [
        { x: 150, y: 200, size: 250, label: 'left' },
        { x: 650, y: 250, size: 220, label: 'right' }
      ]
    },
    brain: {
      name: 'Expanding Brain',
      description: '4-level intelligence',
      fields: ['text1', 'text2', 'text3', 'text4'],
      labels: ['Level 1', 'Level 2', 'Level 3', 'Level 4'],
      winionsNeeded: 4,
      prompt: 'Four horizontal panels stacked vertically, each with empty space on left for character/brain. Backgrounds get progressively more cosmic/ethereal from top to bottom: normal room, starfield, galaxy, transcendent void. NO people, just empty character positions with increasingly dramatic backgrounds',
      positions: [
        { x: 100, y: 100, size: 180, label: 'level1' },
        { x: 100, y: 300, size: 180, label: 'level2' },
        { x: 100, y: 500, size: 180, label: 'level3' },
        { x: 100, y: 700, size: 180, label: 'level4' }
      ]
    }
  };

  const generateMeme = async () => {
    setIsGenerating(true);
    try {
      const template = templates[selectedTemplate];
      
      // Step 1: Generate background template with AI
      const bgPrompt = template.prompt;
      
      const response = await fetch('/api/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          prompt: bgPrompt,
          style: 'background'
        })
      });

      if (!response.ok) {
        throw new Error('Failed to generate background');
      }

      const data = await response.json();
      const bgUrl = data.data[0]?.url;
      
      if (!bgUrl) {
        throw new Error('No background URL returned');
      }

      // Step 2: Load background image
      const bgImg = await loadImage(bgUrl);
      setGeneratedBackground(bgImg);
      
      // Step 3: Randomly select Winions
      const selected = [];
      for (let i = 0; i < template.winionsNeeded; i++) {
        const randomIndex = Math.floor(Math.random() * winionsCollection.length);
        const winion = await loadImage(winionsCollection[randomIndex]);
        selected.push(winion);
      }
      setSelectedWinions(selected);
      
      // Step 4: Composite everything
      compositeMemе(bgImg, selected, template);
      
    } catch (error) {
      console.error('Error:', error);
      alert(error.message || 'Error generating meme. Please try again.');
    } finally {
      setIsGenerating(false);
    }
  };

  const loadImage = (src) => {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.onload = () => resolve(img);
      img.onerror = reject;
      img.src = src;
    });
  };

  const compositeMemе = (background, winions, template) => {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    
    // Set canvas size based on template
    canvas.width = 1000;
    canvas.height = template.name === 'Expanding Brain' ? 900 : 600;
    
    // Draw background
    ctx.drawImage(background, 0, 0, canvas.width, canvas.height);
    
    // Draw Winions at specified positions
    template.positions.forEach((pos, idx) => {
      if (winions[idx]) {
        // Add slight shadow for depth
        ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
        ctx.shadowBlur = 10;
        ctx.shadowOffsetX = 5;
        ctx.shadowOffsetY = 5;
        
        ctx.drawImage(winions[idx], pos.x, pos.y, pos.size, pos.size);
        
        // Reset shadow
        ctx.shadowColor = 'transparent';
        ctx.shadowBlur = 0;
      }
    });
    
    // Add text labels based on template
    addTextLabels(ctx, canvas, template);
    
    // Watermark
    ctx.font = 'bold 20px Arial';
    ctx.fillStyle = '#ef4444';
    ctx.textAlign = 'center';
    ctx.fillText('WINIONS.XYZ', canvas.width / 2, canvas.height - 20);
    
    setPreviewCanvas(canvas);
  };

  const addTextLabels = (ctx, canvas, template) => {
    ctx.font = 'bold 36px Impact, sans-serif';
    ctx.fillStyle = 'white';
    ctx.strokeStyle = 'black';
    ctx.lineWidth = 4;
    ctx.textAlign = 'center';
    
    // Position text based on template type
    if (selectedTemplate === 'distracted') {
      // Text above each character
      ctx.strokeText(texts.text1.toUpperCase(), 100, 180);
      ctx.fillText(texts.text1.toUpperCase(), 100, 180);
      
      ctx.strokeText(texts.text2.toUpperCase(), 400, 160);
      ctx.fillText(texts.text2.toUpperCase(), 400, 160);
      
      ctx.strokeText(texts.text3.toUpperCase(), 700, 180);
      ctx.fillText(texts.text3.toUpperCase(), 700, 180);
    } else if (selectedTemplate === 'drake') {
      // Text on right side of panels
      ctx.textAlign = 'left';
      ctx.strokeText(texts.text1.toUpperCase(), 350, 200);
      ctx.fillText(texts.text1.toUpperCase(), 350, 200);
      
      ctx.strokeText(texts.text2.toUpperCase(), 350, 550);
      ctx.fillText(texts.text2.toUpperCase(), 350, 550);
    } else if (selectedTemplate === 'buttons') {
      // Text on buttons at top
      ctx.font = 'bold 28px Arial';
      ctx.strokeText(texts.text1.toUpperCase(), 300, 80);
      ctx.fillText(texts.text1.toUpperCase(), 300, 80);
      
      ctx.strokeText(texts.text2.toUpperCase(), 700, 80);
      ctx.fillText(texts.text2.toUpperCase(), 700, 80);
    } else if (selectedTemplate === 'yelling') {
      // Text above each character
      ctx.strokeText(texts.text1.toUpperCase(), 200, 180);
      ctx.fillText(texts.text1.toUpperCase(), 200, 180);
      
      ctx.strokeText(texts.text2.toUpperCase(), 700, 230);
      ctx.fillText(texts.text2.toUpperCase(), 700, 230);
    } else if (selectedTemplate === 'brain') {
      // Text to right of each level
      ctx.textAlign = 'left';
      ctx.font = 'bold 32px Impact, sans-serif';
      
      ['text1', 'text2', 'text3', 'text4'].forEach((key, idx) => {
        const y = 160 + (idx * 200);
        ctx.strokeText(texts[key].toUpperCase(), 320, y);
        ctx.fillText(texts[key].toUpperCase(), 320, y);
      });
    }
  };

  useEffect(() => {
    if (generatedBackground && selectedWinions.length > 0) {
      compositeMemе(generatedBackground, selectedWinions, templates[selectedTemplate]);
    }
  }, [texts]);

  const downloadMeme = () => {
    if (previewCanvas) {
      previewCanvas.toBlob((blob) => {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `winions-${selectedTemplate}-meme.png`;
        a.click();
        URL.revokeObjectURL(url);
      });
    }
  };

  return (
    <div className="min-h-screen bg-black text-white p-4 sm:p-6 lg:p-8">
      <div className="max-w-7xl mx-auto">
        <div className="text-center mb-6 sm:mb-8">
          <h1 className="text-3xl sm:text-5xl font-black mb-2 text-red-500 tracking-wider">
            WINIONS AI MEME GENERATOR
          </h1>
          <p className="text-sm sm:text-base text-gray-400">AI-generated templates + your Winions = viral memes</p>
        </div>

        <div className="grid lg:grid-cols-2 gap-6">
          {/* Preview */}
          <div className="border border-gray-800 rounded-lg p-6">
            <h2 className="text-xl font-bold mb-4 text-red-500">PREVIEW</h2>
            
            <div className="relative bg-gray-900 rounded-lg overflow-hidden border border-gray-800 flex items-center justify-center" style={{minHeight: '400px'}}>
              {previewCanvas ? (
                <img src={previewCanvas.toDataURL()} alt="Meme Preview" className="max-w-full h-auto" />
              ) : (
                <div className="text-center p-8">
                  <Sparkles className="w-16 h-16 mx-auto mb-4 text-red-500" />
                  <p className="text-gray-400">Generate a meme to see preview</p>
                  <p className="text-xs text-gray-600 mt-2">AI will create the background, then place your Winions</p>
                </div>
              )}
            </div>

            <button
              onClick={downloadMeme}
              disabled={!previewCanvas}
              className="w-full mt-4 bg-red-600 hover:bg-red-700 disabled:bg-gray-700 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-lg transition-all flex items-center justify-center gap-2"
            >
              <Download className="w-5 h-5" />
              DOWNLOAD MEME
            </button>
          </div>

          {/* Controls */}
          <div className="space-y-4">
            {/* Template Selection */}
            <div className="border border-gray-800 rounded-lg p-6 bg-gray-900">
              <h3 className="text-xl font-bold mb-4 text-red-500">MEME FORMAT</h3>
              
              <div className="grid grid-cols-2 gap-2 mb-4">
                {Object.entries(templates).map(([key, template]) => (
                  <button
                    key={key}
                    onClick={() => setSelectedTemplate(key)}
                    className={`p-3 rounded-lg font-semibold transition-all text-left ${
                      selectedTemplate === key
                        ? 'bg-red-600 text-white'
                        : 'bg-black border border-gray-800 text-gray-400 hover:border-gray-700'
                    }`}
                  >
                    <div className="font-bold text-sm">{template.name}</div>
                    <div className="text-xs opacity-75">{template.description}</div>
                  </button>
                ))}
              </div>

              <button
                onClick={generateMeme}
                disabled={isGenerating}
                className="w-full bg-red-600 hover:bg-red-700 disabled:bg-gray-700 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-lg transition-all flex items-center justify-center gap-2"
              >
                {isGenerating ? (
                  <>
                    <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" />
                    Generating AI Background...
                  </>
                ) : (
                  <>
                    <Zap className="w-5 h-5" />
                    GENERATE MEME
                  </>
                )}
              </button>
              
              <p className="text-xs text-gray-500 mt-2 text-center">
                AI generates template, then places your Winions
              </p>
            </div>

            {/* Text Inputs */}
            <div className="border border-gray-800 rounded-lg p-6 bg-gray-900">
              <h3 className="text-xl font-bold mb-4 text-red-500">TEXT LABELS</h3>
              
              <div className="space-y-3">
                {templates[selectedTemplate].fields.map((field, idx) => (
                  <div key={field}>
                    <label className="block text-sm font-semibold text-gray-400 mb-2">
                      {templates[selectedTemplate].labels[idx]}
                    </label>
                    <input
                      type="text"
                      value={texts[field]}
                      onChange={(e) => setTexts({...texts, [field]: e.target.value})}
                      className="w-full bg-black border border-gray-800 rounded-lg px-4 py-2 text-white placeholder-gray-600 focus:outline-none focus:border-red-500"
                      placeholder={`Enter text...`}
                    />
                  </div>
                ))}
              </div>
            </div>

            <div className="border border-red-900 rounded-lg p-6 bg-gradient-to-br from-red-950/20 to-black text-center">
              <h3 className="text-xl font-bold mb-2 text-red-500">HOW IT WORKS</h3>
              <div className="text-sm text-gray-400 text-left space-y-2">
                <p>✨ <strong>AI generates</strong> the meme template background</p>
                <p>👻 <strong>Your Winions</strong> are placed as characters</p>
                <p>📝 <strong>Add text</strong> labels to complete the meme</p>
                <p>💾 <strong>Download</strong> and share everywhere!</p>
              </div>
              <a 
                href="https://winions.xyz" 
                target="_blank" 
                rel="noopener noreferrer"
                className="inline-block mt-4 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg transition-all"
              >
                WINIONS.XYZ
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<WinionsMemeGenerator />);
    </script>
</body>
</html>
